# ðŸ“‹ Guide Utilisateur - Suivi Encaissement CIE

## ðŸ¢ **PrÃ©sentation de l'Application**

L'application **Suivi Encaissement** est une plateforme web dÃ©veloppÃ©e pour la **Compagnie Ivoirienne d'Ã‰lectricitÃ© (CIE)** permettant de gÃ©rer et suivre l'ensemble du processus d'encaissement des paiements clients.

### **Objectifs**

- Digitaliser le processus de suivi des encaissements
- Automatiser les tÃ¢ches rÃ©pÃ©titives
- AmÃ©liorer la traÃ§abilitÃ© des opÃ©rations
- RÃ©duire les erreurs manuelles
- AccÃ©lÃ©rer le traitement des encaissements

---

## ðŸš€ **DÃ©marrage Rapide**

### **PrÃ©requis**

- Navigateur web moderne (Chrome, Firefox, Safari, Edge)
- Connexion internet stable
- Compte utilisateur valide avec habilitations appropriÃ©es

### **AccÃ¨s Ã  l'application**

1. Ouvrez votre navigateur web
2. AccÃ©dez Ã  l'URL de l'application
3. Connectez-vous avec vos identifiants
4. Si c'est votre premiÃ¨re connexion, vous devrez changer votre mot de passe

---

## ðŸ  **Tableau de Bord (Dashboard)**

### **Vue d'ensemble**

Le tableau de bord offre une vision globale des encaissements avec :

- **Taux de complÃ©tion global** : Pourcentage des encaissements traitÃ©s
- **Montants totaux** : Bordereau, RelevÃ© et Total
- **Graphiques de progression** : Visualisation des tendances
- **Alertes et notifications** : Informations importantes
- **Filtres dynamiques** : Par Direction RÃ©gionale, secteurs, pÃ©riodes

### **FonctionnalitÃ©s principales**

- **Vue graphique/tableau** : Basculement entre les modes d'affichage
- **Filtres avancÃ©s** : SÃ©lection par DR, exploitation, dates
- **Export de donnÃ©es** : GÃ©nÃ©ration de rapports Excel/PDF
- **Actualisation en temps rÃ©el** : DonnÃ©es mises Ã  jour automatiquement

---

## ðŸ’° **Module Encaissements**

### **Statuts des encaissements**

L'application gÃ¨re 8 statuts diffÃ©rents :

1. **Encaissements ChargÃ©s** (0) : DonnÃ©es importÃ©es, en attente de traitement
2. **Encaissements VÃ©rifiÃ©s** (2) : DonnÃ©es contrÃ´lÃ©es et validÃ©es
3. **Encaissements RejetÃ©s** (1) : DonnÃ©es rejetÃ©es pour correction
4. **Encaissements ValidÃ©s** (3) : ApprouvÃ©s par les superviseurs
5. **Encaissements TraitÃ©s** (7) : FinalisÃ©s et comptabilisÃ©s
6. **RÃ©clamations ReversÃ©es** (4) : Cas particuliers en traitement
7. **Encaissements ClÃ´turÃ©s** (5) : Processus terminÃ©
8. **RÃ©clamations TraitÃ©es** (6) : RÃ©clamations rÃ©solues

### **Actions disponibles**

- **Validation en masse** : Traitement de plusieurs encaissements
- **Modification individuelle** : Ã‰dition des dÃ©tails d'un encaissement
- **Ajout d'observations** : Commentaires sur les opÃ©rations
- **Upload de documents** : PiÃ¨ces justificatives (images, PDF)
- **Export de donnÃ©es** : GÃ©nÃ©ration de rapports

### **Filtres et recherche**

- **Direction RÃ©gionale** : Filtrage par zone gÃ©ographique
- **Secteurs/Exploitations** : Filtrage par unitÃ© opÃ©rationnelle
- **PÃ©riodes** : SÃ©lection de dates spÃ©cifiques
- **Banques** : Filtrage par Ã©tablissement bancaire
- **Statuts** : Filtrage par Ã©tat de traitement

---

## ðŸ”— **Module Rapprochement**

### **FonctionnalitÃ©s**

- **Rapprochement automatique** : Mise en correspondance des donnÃ©es
- **Gestion des Ã©carts** : Identification et traitement des diffÃ©rences
- **Validation des correspondances** : Approbation des rapprochements
- **Historique des opÃ©rations** : TraÃ§abilitÃ© complÃ¨te

### **Types de rapprochement**

- **Rapprochement Jade** : SystÃ¨me principal
- **Rapprochement Smart** : SystÃ¨me intelligent
- **Rapprochement Timbre** : SystÃ¨me spÃ©cialisÃ©

---

## âš–ï¸ **Module Litiges**

### **Gestion des cas particuliers**

- **CrÃ©ation de litiges** : Saisie des cas problÃ©matiques
- **Suivi des rÃ©solutions** : Traitement des litiges
- **Documentation** : PiÃ¨ces justificatives et observations
- **Validation des solutions** : Approbation des rÃ©solutions

---

## ðŸ“Š **Module Ã‰tat des Encaissements**

### **Rapports et analyses**

- **Ã‰tats dÃ©taillÃ©s** : Rapports complets par pÃ©riode
- **Analyses comparatives** : Comparaisons entre pÃ©riodes
- **Indicateurs de performance** : KPIs et mÃ©triques
- **Export de rapports** : GÃ©nÃ©ration de documents

---

## ðŸ‘¥ **Module Administration**

### **Gestion des utilisateurs**

- **CrÃ©ation de comptes** : Ajout de nouveaux utilisateurs
- **Gestion des profils** : Modification des informations
- **Attribution des habilitations** : DÃ©finition des droits d'accÃ¨s
- **Suivi des connexions** : Historique des accÃ¨s

### **Gestion des habilitations**

- **DÃ©finition des rÃ´les** : CrÃ©ation de profils utilisateurs
- **Attribution des permissions** : Droits LIRE/ECRIRE/SUPPRIMER
- **Gestion des accÃ¨s** : ContrÃ´le des fonctionnalitÃ©s
- **Audit des droits** : VÃ©rification des habilitations

### **ParamÃ¨tres systÃ¨me**

- **Configuration gÃ©nÃ©rale** : ParamÃ¨tres de l'application
- **Gestion des rÃ©fÃ©rences** : Codes et libellÃ©s
- **Maintenance** : Outils d'administration

---

## ðŸ”§ **FonctionnalitÃ©s Techniques**

### **Interface utilisateur**

- **Design responsive** : Adaptation Ã  tous les Ã©crans
- **Mode sombre/clair** : Personnalisation de l'affichage
- **Navigation intuitive** : Menu et breadcrumbs
- **Notifications** : Alertes et messages d'information

### **SÃ©curitÃ©**

- **Authentification sÃ©curisÃ©e** : Connexion protÃ©gÃ©e
- **Gestion des sessions** : ContrÃ´le des accÃ¨s
- **Audit trail** : TraÃ§abilitÃ© des actions
- **Chiffrement des donnÃ©es** : Protection des informations

### **Performance**

- **Pagination** : Chargement optimisÃ© des donnÃ©es
- **Recherche rapide** : Filtrage en temps rÃ©el
- **Cache intelligent** : Mise en cache des donnÃ©es
- **Actualisation automatique** : DonnÃ©es Ã  jour

---

## ðŸ“± **Utilisation Mobile**

### **CompatibilitÃ©**

- **Tablettes** : Interface adaptÃ©e aux Ã©crans moyens
- **Smartphones** : Version mobile optimisÃ©e
- **Navigation tactile** : Gestes et interactions tactiles
- **Performance optimisÃ©e** : Chargement rapide sur mobile

---

## ðŸ†˜ **Support et Aide**

### **Ressources disponibles**

- **Guide d'utilisation** : Documentation complÃ¨te
- **Tutoriels intÃ©grÃ©s** : Aide contextuelle
- **FAQ** : Questions frÃ©quentes
- **Support technique** : Assistance en cas de problÃ¨me

### **Contact support**

- **Email** : support@cie.ci
- **TÃ©lÃ©phone** : +225 XX XX XX XX
- **Chat en ligne** : Support intÃ©grÃ© Ã  l'application

---

## ðŸ”„ **Mises Ã  jour et Maintenance**

### **Nouvelles fonctionnalitÃ©s**

- **Mises Ã  jour rÃ©guliÃ¨res** : AmÃ©liorations continues
- **Nouvelles fonctionnalitÃ©s** : Ã‰volution de l'application
- **Corrections de bugs** : RÃ©solution des problÃ¨mes
- **Optimisations** : AmÃ©lioration des performances

### **Maintenance prÃ©ventive**

- **Sauvegardes automatiques** : Protection des donnÃ©es
- **Maintenance programmÃ©e** : Interventions planifiÃ©es
- **Monitoring** : Surveillance continue
- **SÃ©curitÃ©** : Mises Ã  jour de sÃ©curitÃ©

---

## ðŸ“‹ **Checklist Utilisateur**

### **Avant de commencer**

- [ ] VÃ©rifier votre connexion internet
- [ ] Avoir vos identifiants de connexion
- [ ] VÃ©rifier vos habilitations
- [ ] Consulter les notifications importantes

### **Utilisation quotidienne**

- [ ] Consulter le tableau de bord
- [ ] Traiter les encaissements en attente
- [ ] VÃ©rifier les rapprochements
- [ ] GÃ©rer les litiges Ã©ventuels
- [ ] Exporter les rapports nÃ©cessaires

### **Fin de journÃ©e**

- [ ] Valider les opÃ©rations en cours
- [ ] Sauvegarder les modifications
- [ ] Consulter les statistiques
- [ ] Planifier les tÃ¢ches du lendemain

---

## ðŸŽ¯ **Bonnes Pratiques**

### **SÃ©curitÃ©**

- Changez rÃ©guliÃ¨rement votre mot de passe
- Ne partagez jamais vos identifiants
- DÃ©connectez-vous aprÃ¨s chaque session
- Signalez tout comportement suspect

### **EfficacitÃ©**

- Utilisez les raccourcis clavier
- Organisez vos filtres frÃ©quents
- Sauvegardez rÃ©guliÃ¨rement vos travaux
- Consultez l'aide en ligne si nÃ©cessaire

### **Collaboration**

- Communiquez avec votre Ã©quipe
- Partagez les bonnes pratiques
- Signalez les amÃ©liorations possibles
- Participez aux formations

---

## ðŸ“ž **Contact et Support**

Pour toute question ou assistance :

**Support Technique**

- Email : support@cie.ci
- TÃ©lÃ©phone : +225 XX XX XX XX
- Horaires : 8h00 - 18h00 (Lun-Ven)

**Administrateur SystÃ¨me**

- Email : admin@cie.ci
- TÃ©lÃ©phone : +225 XX XX XX XX

---

## ðŸ”§ **Guide Technique - Backend API**

### **Table des MatiÃ¨res**

1. [Introduction](#introduction)
2. [PrÃ©sentation du SystÃ¨me](#prÃ©sentation-du-systÃ¨me)
3. [Architecture Technique](#architecture-technique)
4. [Installation et Configuration](#installation-et-configuration)
5. [Authentification](#authentification)
6. [Modules Fonctionnels](#modules-fonctionnels)
7. [Interface d'Administration](#interface-dadministration)
8. [API et Endpoints](#api-et-endpoints)
9. [Gestion des Permissions](#gestion-des-permissions)
10. [Rapports et Statistiques](#rapports-et-statistiques)
11. [Maintenance et Troubleshooting](#maintenance-et-troubleshooting)
12. [FAQ](#faq)

---

### **Introduction**

Le **SystÃ¨me de Suivi des Encaissements CIE** est une application web dÃ©veloppÃ©e pour la Compagnie Ivoirienne d'Ã‰lectricitÃ© (CIE) permettant de gÃ©rer, suivre et valider les encaissements effectuÃ©s dans les diffÃ©rentes agences et points de collecte.

#### **Objectifs du SystÃ¨me**

- **Centralisation** : Centraliser tous les encaissements de la CIE
- **TraÃ§abilitÃ©** : Assurer un suivi complet des transactions
- **Validation** : Mettre en place un workflow de validation multi-niveaux
- **Rapprochement** : Faciliter le rapprochement comptable entre diffÃ©rents systÃ¨mes
- **Alertes** : GÃ©nÃ©rer des alertes pour les dossiers nÃ©cessitant une attention particuliÃ¨re

---

### **PrÃ©sentation du SystÃ¨me**

#### **FonctionnalitÃ©s Principales**

1. **Gestion des Encaissements**

   - Enregistrement des transactions
   - Suivi des modes de rÃ¨glement (chÃ¨que, espÃ¨ces)
   - Gestion des bordereaux bancaires
   - Calcul automatique des Ã©carts

2. **Workflow de Validation**

   - Validation par niveaux hiÃ©rarchiques
   - Gestion des observations et commentaires
   - Traitement des rÃ©clamations
   - ClÃ´ture des dossiers

3. **Rapprochements Comptables**

   - Rapprochement JADE/SAPHIR
   - Rapprochement JADE/SMART
   - Rapprochement des timbres

4. **Tableaux de Bord**
   - Statistiques en temps rÃ©el
   - Graphiques de performance
   - Alertes et notifications

---

### **Architecture Technique**

#### **Technologies UtilisÃ©es**

- **Backend** : NestJS (Node.js)
- **Base de DonnÃ©es** : MySQL avec Prisma ORM
- **Authentification** : JWT + Keycloak (optionnel)
- **Email** : Nodemailer
- **Upload de Fichiers** : Multer
- **Documentation API** : Swagger (implicite)

#### **Structure du Projet**

```
src/
â”œâ”€â”€ auth/                 # Module d'authentification
â”œâ”€â”€ users/               # Gestion des utilisateurs
â”œâ”€â”€ encaissements/       # Module principal encaissements
â”œâ”€â”€ dashboard/           # Tableaux de bord
â”œâ”€â”€ rapprochements/      # Rapprochements comptables
â”œâ”€â”€ mail/                # Service d'emails
â”œâ”€â”€ shared/              # Services partagÃ©s
â”‚   â”œâ”€â”€ guards/          # Guards d'authentification
â”‚   â”œâ”€â”€ interceptors/    # Intercepteurs
â”‚   â”œâ”€â”€ services/        # Services utilitaires
â”‚   â””â”€â”€ utils/           # Fonctions utilitaires
â””â”€â”€ main.ts             # Point d'entrÃ©e
```

---

### **Installation et Configuration**

#### **PrÃ©requis**

- Node.js (version 16+)
- MySQL (version 8+)
- npm ou yarn

#### **Installation**

1. **Cloner le repository**

```bash
git clone [URL_DU_REPO]
cd suivi_encaissement_api
```

2. **Installer les dÃ©pendances**

```bash
npm install
```

3. **Configuration de l'environnement**
   CrÃ©er un fichier `.env` avec les variables suivantes :

```env
# Base de donnÃ©es
DATABASE_URL="mysql://user:password@localhost:3306/suivi_encaissement_db"

# JWT
JWT_SECRET="votre_secret_jwt"
REFRESH_TOKEN_SECRET="votre_secret_refresh_token"

# Frontend URL
FRONTEND_URL="http://localhost:3000"

# Email
MAIL_HOST="smtp.exemple.com"
MAIL_PORT=587
MAIL_USER="user@exemple.com"
MAIL_PASSWORD="password"

# Port du serveur
PORT=2402
```

4. **Configuration de la base de donnÃ©es**

```bash
# GÃ©nÃ©rer le client Prisma
npm run g

# Appliquer les migrations
npm run m
```

5. **DÃ©marrer l'application**

```bash
# Mode dÃ©veloppement
npm run dev

# Mode production
npm run start:prod
```

---

### **Authentification**

#### **SystÃ¨me d'Authentification**

Le systÃ¨me utilise un double systÃ¨me d'authentification :

- **JWT** pour les sessions
- **Keycloak** (optionnel) pour l'intÃ©gration SSO

#### **Processus de Connexion**

1. **Inscription d'un nouvel utilisateur**

   - POST `/auth/sign-up`
   - NÃ©cessite les droits administrateur
   - Envoi automatique d'email avec identifiants

2. **Connexion**

   - POST `/auth/sign-in`
   - Login possible avec email ou matricule
   - Retourne un access_token et refresh_token

3. **PremiÃ¨re connexion**
   - L'utilisateur doit changer son mot de passe
   - POST `/auth/change-password-first-login`

#### **Gestion des Mots de Passe**

1. **Mot de passe par dÃ©faut** : `Encaissement2024`

2. **RÃ©initialisation**

   - Demande : POST `/auth/request-reset-password`
   - RÃ©initialisation : POST `/auth/reset-password`
   - Code OTP envoyÃ© par email

3. **Changement de mot de passe**
   - POST `/auth/change-password`

#### **Tokens et Sessions**

- **Access Token** : DurÃ©e de vie 2 heures
- **Refresh Token** : DurÃ©e de vie 4 heures
- DÃ©connexion automatique aprÃ¨s expiration

---

### **Modules Fonctionnels**

#### **1. Module Encaissements**

##### **Gestion des Encaissements**

**Endpoints principaux :**

- `GET /encaissements` - Liste paginÃ©e des encaissements
- `GET /encaissements/alerts` - Encaissements nÃ©cessitant attention
- `POST /encaissements/treatment` - Traitement d'un encaissement
- `GET /encaissements/banques` - Liste des banques
- `GET /encaissements/produits` - Liste des produits

##### **Statuts des Encaissements**

1. **CHARGES** (0) : Encaissement crÃ©Ã©, en attente de vÃ©rification
2. **VERIFIES** (1) : Encaissement vÃ©rifiÃ© par le premier niveau
3. **TRAITES** (2) : Encaissement traitÃ© par le second niveau
4. **RECLAMATION** (3) : Encaissement en rÃ©clamation
5. **CLOTURES** (4) : Encaissement clÃ´turÃ©

##### **Workflow de Validation**

```mermaid
graph TD
    A[Encaissement crÃ©Ã©] --> B[CHARGES]
    B --> C[VÃ©rification N1]
    C --> D[VERIFIES]
    D --> E[Traitement N2]
    E --> F[TRAITES]
    F --> G[CLOTURES]
    D --> H[RECLAMATION]
    H --> E
```

##### **Champs d'un Encaissement**

- **Identification**

  - `directionRegionale` : Direction rÃ©gionale
  - `codeExpl` : Code d'exploitation
  - `libelleExpl` : LibellÃ© d'exploitation

- **Caisse**

  - `dateEncaissement` : Date de l'encaissement
  - `codeCaisse` : Code de la caisse
  - `numeroCaisse` : NumÃ©ro de caisse
  - `numeroJourneeCaisse` : JournÃ©e de caisse
  - `matriculeCaissiere` : Matricule de la caissiÃ¨re
  - `fullnameCaissiere` : Nom complet de la caissiÃ¨re

- **Montants**

  - `montantCheque` : Montant chÃ¨que
  - `montantEspece` : Montant espÃ¨ces
  - `montantBordereauBanqueCheque` : Montant bordereau banque (chÃ¨que)
  - `montantBordereauBanqueEspece` : Montant bordereau banque (espÃ¨ce)

- **Bancaire**

  - `banque` : Nom de la banque
  - `compteBanque` : NumÃ©ro de compte
  - `codeBanque` : Code banque
  - `numeroBordereau` : NumÃ©ro de bordereau

- **Ã‰carts calculÃ©s**
  - `ecartCaisseBanqueCheque` : Ã‰cart caisse/banque (chÃ¨que)
  - `ecartCaisseBanqueEspece` : Ã‰cart caisse/banque (espÃ¨ce)

#### **2. Module Dashboard**

##### **Indicateurs Principaux**

1. **Taux de Completion**

   - Total des dossiers
   - Dossiers clÃ´turÃ©s
   - Dossiers en rÃ©clamation
   - Dossiers validÃ©s
   - Dossiers reversÃ©s

2. **Top 5 des Caisses**

   - Plus de dossiers clÃ´turÃ©s
   - Moins de dossiers clÃ´turÃ©s

3. **DonnÃ©es de Revenus**

   - Ã‰volution mensuelle
   - Encaissements clÃ´turÃ©s vs reversÃ©s

4. **Analyse des Ã‰carts**
   - Ã‰carts par direction rÃ©gionale
   - Montants A, B, C
   - Ã‰carts AB et BC

##### **Endpoints Dashboard**

- `GET /dashboard` - DonnÃ©es principales du dashboard
- `GET /dashboard/revenue` - DonnÃ©es de revenus
- `GET /dashboard/completion-rate` - Taux de completion
- `GET /dashboard/top-caisses` - Top 5 des caisses
- `GET /dashboard/ecarts` - DonnÃ©es d'Ã©carts

#### **3. Module Utilisateurs**

##### **Gestion des Utilisateurs**

**Structure d'un utilisateur :**

- Informations personnelles (nom, prÃ©nom, matricule, email)
- Profil et permissions
- Directions rÃ©gionales assignÃ©es
- Secteurs assignÃ©s

**Endpoints :**

- `GET /users` - Liste des utilisateurs
- `GET /users/me` - Informations de l'utilisateur connectÃ©
- `PATCH /users/me` - Mise Ã  jour du profil
- `PATCH /users/:id/activate` - Activer un utilisateur
- `PATCH /users/:id/deactivate` - DÃ©sactiver un utilisateur

#### **4. Module Profils et Permissions**

##### **SystÃ¨me de Permissions**

Le systÃ¨me utilise un modÃ¨le de permissions basÃ© sur :

- **Profils** : RÃ´les d'utilisateur (Admin, User, Guest)
- **Objets** : Ressources du systÃ¨me
- **Permissions** : Actions autorisÃ©es (CrÃ©er, Lire, Modifier, Supprimer)

##### **Profils PrÃ©dÃ©finis**

1. **ADMIN** (Level 1)

   - AccÃ¨s complet au systÃ¨me
   - Gestion des utilisateurs
   - Configuration systÃ¨me

2. **USER** (Level 2)

   - AccÃ¨s aux fonctionnalitÃ©s mÃ©tier
   - Validation des encaissements

3. **GUEST** (Level 3)
   - AccÃ¨s en lecture seule

#### **5. Module Rapprochements**

##### **Types de Rapprochements**

1. **JADE/SAPHIR**

   - Rapprochement entre systÃ¨mes JADE et SAPHIR
   - Comparaison des montants chÃ¨ques et espÃ¨ces

2. **JADE/SMART**

   - Rapprochement entre JADE et SMART
   - Focus sur les montants espÃ¨ces

3. **Rapprochement Timbres**
   - VÃ©rification des montants de timbres
   - Comparaison JADE vs encaissements

---

### **Interface d'Administration**

#### **Gestion des Utilisateurs**

1. **CrÃ©ation d'utilisateur**

   - Formulaire avec informations obligatoires
   - Assignation de profil
   - SÃ©lection des directions rÃ©gionales et secteurs
   - Envoi automatique d'email avec identifiants

2. **Gestion des statuts**
   - Activation/DÃ©sactivation
   - Verrouillage de compte
   - RÃ©initialisation de mot de passe

#### **Gestion des Profils**

1. **CrÃ©ation de profils personnalisÃ©s**
2. **Attribution de permissions granulaires**
3. **Gestion des niveaux d'accÃ¨s**

#### **Configuration SystÃ¨me**

1. **ParamÃ¨tres gÃ©nÃ©raux**

   - Seuils d'alerte
   - Configuration des emails
   - ParamÃ¨tres de sÃ©curitÃ©

2. **Gestion des rÃ©fÃ©rentiels**
   - Directions rÃ©gionales
   - Secteurs
   - Banques
   - Produits

---

### **API et Endpoints**

#### **Structure des RÃ©ponses**

Toutes les rÃ©ponses API suivent le format standard :

```json
{
  "data": {
    // DonnÃ©es de la rÃ©ponse
  },
  "message": "Message descriptif",
  "success": true,
  "statusCode": 200
}
```

#### **Pagination**

Les endpoints de liste supportent la pagination :

**ParamÃ¨tres de query :**

- `page` : NumÃ©ro de page (dÃ©faut: 1)
- `limit` : Nombre d'Ã©lÃ©ments par page (dÃ©faut: 10)
- `sortBy` : Champ de tri
- `sortDirection` : Direction du tri (asc/desc)
- `search` : Terme de recherche

**RÃ©ponse paginÃ©e :**

```json
{
  "data": {
    "result": [], // DonnÃ©es
    "total": 100, // Total d'Ã©lÃ©ments
    "page": 1, // Page actuelle
    "limit": 10, // Limite par page
    "totalPages": 10 // Total de pages
  }
}
```

#### **Filtres**

La plupart des endpoints supportent des filtres :

```json
{
  "filters": {
    "periode": {
      "startDate": "2024-01-01",
      "endDate": "2024-12-31"
    },
    "directionRegional": ["DR1", "DR2"],
    "banque": ["BANQUE1", "BANQUE2"],
    "produit": ["PRODUIT1"],
    "statut": [1, 2]
  }
}
```

#### **Endpoints Principaux**

##### **Authentification**

```
POST /auth/sign-in              # Connexion
POST /auth/sign-up              # Inscription (Admin)
POST /auth/refresh-token        # Renouvellement token
POST /auth/logout               # DÃ©connexion
POST /auth/change-password      # Changement mot de passe
POST /auth/request-reset-password # Demande rÃ©initialisation
POST /auth/reset-password       # RÃ©initialisation
```

##### **Encaissements**

```
GET /encaissements              # Liste des encaissements
GET /encaissements/alerts       # Alertes
GET /encaissements/alerts-count # Compteur d'alertes
POST /encaissements/treatment   # Traitement
GET /encaissements/banques      # Liste des banques
GET /encaissements/produits     # Liste des produits
```

##### **Dashboard**

```
GET /dashboard                  # DonnÃ©es principales
GET /dashboard/revenue          # DonnÃ©es revenus
GET /dashboard/completion-rate  # Taux completion
GET /dashboard/top-caisses      # Top caisses
GET /dashboard/ecarts          # DonnÃ©es Ã©carts
```

##### **Utilisateurs**

```
GET /users                     # Liste utilisateurs
GET /users/me                  # Profil utilisateur
PATCH /users/me               # Mise Ã  jour profil
PATCH /users/:id/activate     # Activation
PATCH /users/:id/deactivate   # DÃ©sactivation
```

---

### **Gestion des Permissions**

#### **Matrice de Permissions**

Le systÃ¨me utilise une matrice Profil x Objet x Permission :

| Profil | Objet         | Permissions |
| ------ | ------------- | ----------- |
| ADMIN  | Tous          | C, R, U, D  |
| USER   | Encaissements | R, U        |
| USER   | Dashboard     | R           |
| GUEST  | Dashboard     | R           |

#### **VÃ©rification des Permissions**

Les permissions sont vÃ©rifiÃ©es Ã  deux niveaux :

1. **Guards** : VÃ©rification au niveau des routes
2. **Services** : VÃ©rification au niveau mÃ©tier

#### **Configuration des Permissions**

Les permissions sont configurÃ©es dans la base de donnÃ©es via les tables :

- `Profile` : DÃ©finition des profils
- `Permission` : Types de permissions
- `Object` : Objets du systÃ¨me
- `ProfileObjectPermissions` : Association des permissions

---

### **Rapports et Statistiques**

#### **Types de Rapports**

1. **Rapports OpÃ©rationnels**

   - Encaissements par pÃ©riode
   - Statut des validations
   - RÃ©clamations en cours

2. **Rapports Financiers**

   - Montants encaissÃ©s
   - Ã‰carts identifiÃ©s
   - Rapprochements comptables

3. **Rapports de Performance**
   - Temps de traitement
   - Taux de validation
   - Performance par caisse

#### **SystÃ¨me d'Alertes**

##### **Types d'Alertes**

1. **Alertes de DÃ©lais**

   - Dossiers CHARGES > 5 jours
   - Dossiers VERIFIES > 3 jours
   - Dossiers TRAITES > 2 jours
   - RÃ©clamations > 7 jours

2. **Alertes d'Ã‰carts**
   - Ã‰carts significatifs dÃ©tectÃ©s
   - Montants incohÃ©rents

##### **Configuration des Seuils**

Les seuils d'alerte sont configurables dans `src/shared/enums/enum.ts` :

```typescript
export enum ESeuils {
  CHARGES = 5, // 5 jours
  VERIFIE = 3, // 3 jours
  VALIDE = 2, // 2 jours
  LITIGE = 7, // 7 jours
}
```

#### **Exports de DonnÃ©es**

Le systÃ¨me permet l'export des donnÃ©es en diffÃ©rents formats :

- Excel (XLSX)
- CSV
- PDF (rapports)

---

### **Maintenance et Troubleshooting**

#### **Monitoring**

##### **Logs d'Application**

Les logs sont gÃ©rÃ©s par NestJS et incluent :

- Logs d'authentification
- Logs d'erreurs
- Logs de performance
- Logs de sÃ©curitÃ©

##### **Historique des Actions**

Le systÃ¨me maintient un historique complet des actions via :

- `Action` : Log des actions utilisateur
- `ConnectionHistory` : Historique des connexions
- Audit trail des modifications

#### **Sauvegarde et Restauration**

##### **Sauvegarde de la Base de DonnÃ©es**

```bash
# Sauvegarde complÃ¨te
mysqldump -u username -p suivi_encaissement_db > backup.sql

# Sauvegarde avec compression
mysqldump -u username -p suivi_encaissement_db | gzip > backup.sql.gz
```

##### **Restauration**

```bash
# Restauration
mysql -u username -p suivi_encaissement_db < backup.sql

# Restauration depuis archive compressÃ©e
gunzip < backup.sql.gz | mysql -u username -p suivi_encaissement_db
```

#### **ProblÃ¨mes Courants**

##### **1. ProblÃ¨me de Connexion Ã  la Base de DonnÃ©es**

**SymptÃ´mes :** Erreurs de connexion Prisma

**Solution :**

1. VÃ©rifier les paramÃ¨tres `DATABASE_URL`
2. VÃ©rifier que MySQL est dÃ©marrÃ©
3. Tester la connectivitÃ© rÃ©seau

##### **2. Erreurs d'Authentification JWT**

**SymptÃ´mes :** Tokens invalides ou expirÃ©s

**Solution :**

1. VÃ©rifier `JWT_SECRET` et `REFRESH_TOKEN_SECRET`
2. VÃ©rifier la synchronisation des horloges
3. Renouveler les tokens via `/auth/refresh-token`

##### **3. ProblÃ¨mes d'Email**

**SymptÃ´mes :** Emails non envoyÃ©s

**Solution :**

1. VÃ©rifier la configuration SMTP
2. VÃ©rifier les credentials email
3. Tester la connectivitÃ© SMTP

##### **4. Performances Lentes**

**SymptÃ´mes :** RequÃªtes lentes

**Solution :**

1. VÃ©rifier les index de base de donnÃ©es
2. Optimiser les requÃªtes Prisma
3. ImplÃ©menter la mise en cache

#### **Commandes Utiles**

```bash
# DÃ©veloppement
npm run dev                    # DÃ©marrer en mode dÃ©veloppement
npm run start:debug           # DÃ©marrer avec debugger

# Base de donnÃ©es
npm run g                     # GÃ©nÃ©rer client Prisma
npm run m                     # Migrer la base
npm run s                     # Ouvrir Prisma Studio
npm run p                     # Push vers la base

# Docker
npm run dup                   # Docker compose up
npm run ddo                   # Docker compose down
npm run d:d image_name        # Build image Docker

# Tests
npm run test                  # Tests unitaires
npm run test:e2e             # Tests end-to-end
npm run test:cov             # Couverture de tests

# Production
npm run build                 # Build production
npm run start:prod           # DÃ©marrer en production
```

---

### **FAQ**

#### **Questions GÃ©nÃ©rales**

**Q: Comment crÃ©er un nouvel utilisateur ?**
R: Seuls les administrateurs peuvent crÃ©er des utilisateurs via l'endpoint `/auth/sign-up`. L'utilisateur recevra ses identifiants par email.

**Q: Que faire si un utilisateur oublie son mot de passe ?**
R: L'utilisateur peut demander une rÃ©initialisation via `/auth/request-reset-password`. Un code OTP sera envoyÃ© par email.

**Q: Comment sont calculÃ©s les Ã©carts ?**
R: Les Ã©carts sont calculÃ©s automatiquement :

- Ã‰cart A-B : DiffÃ©rence entre montant caisse et bordereau banque
- Ã‰cart B-C : DiffÃ©rence entre bordereau banque et relevÃ©

#### **Questions Techniques**

**Q: Comment modifier les seuils d'alerte ?**
R: Les seuils sont dÃ©finis dans `src/shared/enums/enum.ts` dans l'enum `ESeuils`.

**Q: Comment ajouter une nouvelle permission ?**
R:

1. Ajouter l'objet dans la table `Object`
2. CrÃ©er les permissions associÃ©es
3. Configurer les profils dans `ProfileObjectPermissions`

**Q: Comment personnaliser les templates d'email ?**
R: Les templates sont dans `src/mail/templates/`. Modifier les fichiers `.hbs` selon vos besoins.

#### **RÃ©solution de ProblÃ¨mes**

**Q: L'application ne dÃ©marre pas**
R:

1. VÃ©rifier le fichier `.env`
2. S'assurer que MySQL est dÃ©marrÃ©
3. VÃ©rifier les dÃ©pendances avec `npm install`

**Q: Les emails ne partent pas**
R:

1. VÃ©rifier la configuration SMTP
2. Tester avec un client email externe
3. VÃ©rifier les logs d'erreur

**Q: Les performances sont lentes**
R:

1. VÃ©rifier les index de base de donnÃ©es
2. Analyser les requÃªtes lentes
3. ConsidÃ©rer la mise en cache

---

### **Support et Contact**

#### **Ã‰quipe de DÃ©veloppement**

**DÃ©veloppeur Principal :** Siaka DIARRASSOUBA

- **Email :** Siaka1.diarrassouba@cie.ci
- **Contact :** +225 05 64 34 03 44

#### **Ressources Utiles**

- **Documentation Prisma :** https://www.prisma.io/docs/
- **Documentation NestJS :** https://docs.nestjs.com/
- **Documentation MySQL :** https://dev.mysql.com/doc/

#### **Reporting de Bugs**

Pour reporter un bug :

1. DÃ©crire le comportement attendu vs observÃ©
2. Fournir les Ã©tapes de reproduction
3. Inclure les logs d'erreur
4. PrÃ©ciser l'environnement (dÃ©veloppement/production)

---

_DerniÃ¨re mise Ã  jour : DÃ©cembre 2024_
_Version Frontend : 1.0.0_
_Version Backend : 0.0.1_
